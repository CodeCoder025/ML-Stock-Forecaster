from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import MinMaxScaler

def scaleData(trainingData):
  minMaxScaler = MinMaxScaler(feature_range=(0,1))
  scaledTrainData = pd.DataFrame(minMaxScaler.fit_transform(trainingData.drop(columns=["%changeTomorrow"])), columns = [i for i in trainingData.columns.to_list() if i != "%changeTomorrow"])
  return scaledTrainData

def chronologicalSplit(scaledTrainData,x, nRows):
  trainingRows = int(x*nRows)
  trainingSet = scaledTrainData.loc[0:trainingRows]
  testSet = scaledTrainData.loc[trainingRows+1:]
  return trainingSet, testSet

def deployLinearModel(trainData, testData, trainingData):
  trainData["%changeTomorrow"] = trainingData["%changeTomorrow"]
  testData["%changeTomorrow"] = trainingData["%changeTomorrow"]
  linearRegModel = LinearRegression()
  linearRegModel.fit(trainData.drop(columns = ["%changeTomorrow"]), trainData["%changeTomorrow"])
  linearRegModelPreds =  linearRegModel.predict(testData.drop(columns=["%changeTomorrow"]))

trainingData = implementIndicators(handleOHLC("JNJ"))
nRows, nCols = trainingData.shape
deployLinearModel(*chronologicalSplit(scaleData(trainingData),0.8,nRows), trainingData)
