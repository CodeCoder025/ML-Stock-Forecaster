#Hyperparameter optimization
import matplotlib.pyplot as plt
import numpy as np
def optimizeRF(trainingData):
    nRows, nCols = trainingData.shape
    trainData, testData = chronologicalSplit(scaleData(trainingData), 0.8, nRows)
    n_estimatorList = list(range(50, 400, 25))
    max_samplesList = np.arange(0.2, 0.9, 0.05) #gotta do this because range() cannot take floats
    max_leaf_nodeList = list(range(100, 450,25))
    n_estimatorsHPlist = []
    max_samplesHPlist = []
    max_leaf_nodesHPlist = []
    RMSElist = []
    x = 0
    for i in range(len(n_estimatorList)):
        for j in range(len(max_samplesList)):
            for k in range(len(max_leaf_nodeList)):
                n_estimatorsHPlist.append(n_estimatorList[i])
                max_samplesHPlist.append(max_samplesList[j])
                max_leaf_nodesHPlist.append(max_leaf_nodeList[k])
                _,_,randomForestScore = deployRandomForest(trainData, testData,
                                                           n_dTrees = n_estimatorList[i],
                                                           bootstrapSize = max_samplesList[j],
                                                           max_leaf_nodes = max_leaf_nodeList[k])
                RMSElist.append(randomForestScore)
                x+=1
                print("Progress: %s/%s"%(x, len(n_estimatorList)*len(max_samplesList)*len(max_leaf_nodeList)))
    bestCombiIndex = RMSElist.index(min(RMSElist))
    fig = plt.figure() #How to make 4-metric plots --- https://chatgpt.com/s/t_6953e151d9988191b7bc7da461e03aa0
    ax = fig.add_subplot(projection = "3d")
    scatPlot = ax.scatter(max_samplesHPlist, max_leaf_nodesHPlist, RMSElist, c=n_estimatorsHPlist, cmap = "viridis")
    ax.scatter(max_samplesHPlist[bestCombiIndex],max_leaf_nodesHPlist[bestCombiIndex],RMSElist[bestCombiIndex], color = "green", s=80, marker = "X", label = "OPtimum")
    ax.set_xlabel("Bootstrap Size")
    ax.set_ylabel("Maximum Terminal Nodes")
    ax.set_zlabel("RMSE")
    plt.colorbar(scatPlot, label = "n_estimators")
    plt.show()
    return {"Max Samples" : max_samplesHPlist[bestCombiIndex],"Max Terminal Nodes":max_leaf_nodesHPlist[bestCombiIndex],"n_estimators":n_estimatorsHPlist[bestCombiIndex],"RMSE Score":RMSElist[bestCombiIndex]}

tunedDict = optimizeRF(trainingData)
