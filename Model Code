import pandas as pd
import numpy as np
import yfinance as yf
#IMPORTANT TO REMEMBER: I cannot have the model predict today's price change using today's volume --- i can only use the data which I had before today. Prices to predict are close prices, not high,low, or open!
#Columns which has a name starting with "!" are columns which CANNOT be given to the model in predicting prices.
#Idea: Can also one-hot encode for crossovers
#An important concept to note throughout the course of this project is that the model is not able to cross-compare between metrics, thus any possible correlation must be spoon-fed. It is also worth noting that the model cannot put things into context, metrics have to be put into a percentage with little undesirable drift over time. (e.g. if i feed it OHLC< predictions will take after more recent price action, because open, high, low, and close prices now are more like those in 2025 than those in 1995.
OHLC_data = yf.download("JNJ", start = "1995-01-01", end = "2025-01-01").reset_index()
initial_rows, _ = OHLC_data.shape
OHLC_data.columns = OHLC_data.columns.get_level_values(0)
OHLC_data["!tomorrowPrice"] = OHLC_data["Close"].shift(-1)
OHLC_data.dropna(inplace = True)
OHLC_data["%changeTomorrow"] = (OHLC_data["!tomorrowPrice"]-OHLC_data["Close"])/OHLC_data["Close"] #This is the target variable

def xDMA_column(x):
    columnNamePrc = "PriceTo%sDay_SMA"%x
    columnNameVol = "VolumeTo%sDay_SMA"%x
    OHLC_data[columnNameVol] = None
    OHLC_data[columnNamePrc] = None
    columnIndexPrc = OHLC_data.columns.get_loc(columnNamePrc)
    columnIndexVol = OHLC_data.columns.get_loc(columnNameVol)
    for index, row in OHLC_data.iterrows():
        if index < x:
            continue
        else:
            cumSumPrc = 0
            cumSumVol = 0
            for i in range(0,5):
                cumSumPrc += (OHLC_data.iloc[index-i,1]+OHLC_data.iloc[index-1,4])/2
                cumSumVol += OHLC_data.iloc[index-i, 5]
            PrcMA = cumSumPrc/x
            VolMA = cumSumVol/x
            OHLC_data.iloc[index,columnIndexPrc] = row["Close"]/PrcMA
            OHLC_data.iloc[index, columnIndexVol] = row["Volume"]/VolMA
    OHLC_data.dropna(inplace=True)
xDMA_column(5)
